/data/vsrivatsa/overparam_spur_corr
luigi
Sun Sep 12 12:45:03 PDT 2021
starting job...
Dataset: Breeds
Shift type: confounder
Target name: breeds
Confounder names: None
Resume: False
Minority fraction: None
Imbalance ratio: None
Fraction: 1.0
Root dir: None
Subsample to minority: False
Reweight groups: False
Augment data: False
Val fraction: 0.1
Breeds dataset type: entity13
Breeds pair: None
Breeds proportions: None
Breeds cpu: None
Reload breeds groups: False
Breeds external group: None
Breeds color dots: True
Robust: False
Alpha: 0.2
Generalization adjustment: 0
Automatic adjustment: False
Robust step size: 0.01
Use normalized loss: False
Btl: False
Hinge: False
Model: resnet18
Train from scratch: True
Resnet width: None
N epochs: 300
Batch size: 128
Lr: 0.1
Scheduler: False
Step scheduler: True
Scheduler step: 120
Weight decay: 0.0001
Gamma: 0.1
Minimum variational weight: 0
Seed: 0
Show progress: False
Log dir: ./logs/ERM_breeds/mammal-bird-pair-dots/fbe0dbce-16ac-441b-b3e2-88be1707e2a8
Log every: 50
Save step: 10
Save best: True
Save last: True

==> Preparing dataset custom_imagenet..
==> Preparing dataset custom_imagenet..
Realign dataset classes to 0,1
group counts [13485 13435 13356 13565]
sizes 37689 5384 10768
Completed initializing breeds
Training Data...
    Color 0, Class: fmammal: n = 9410
    Color 0, Class: fbird: n = 9413
    Color 1, Class: fmammal: n = 9345
    Color 1, Class: fbird: n = 9521
Validation Data...
    Color 0, Class: fmammal: n = 1326
    Color 0, Class: fbird: n = 1341
    Color 1, Class: fmammal: n = 1383
    Color 1, Class: fbird: n = 1334
Test Data...
    Color 0, Class: fmammal: n = 2749
    Color 0, Class: fbird: n = 2681
    Color 1, Class: fmammal: n = 2628
    Color 1, Class: fbird: n = 2710

Epoch [0]:
Training:
Average incurred loss: 2.095  
Average sample loss: 2.095  
Average acc: 0.495  
  Color 0, Class: fmammal  [n = 1598]:	loss = 2.372  exp loss = 1.087  adjusted loss = 1.087  adv prob = 0.250000   acc = 0.489
  Color 0, Class: fbird  [n = 1612]:	loss = 2.403  exp loss = 1.316  adjusted loss = 1.316  adv prob = 0.250000   acc = 0.498
  Color 1, Class: fmammal  [n = 1644]:	loss = 1.827  exp loss = 0.864  adjusted loss = 0.864  adv prob = 0.250000   acc = 0.487
  Color 1, Class: fbird  [n = 1546]:	loss = 1.773  exp loss = 0.910  adjusted loss = 0.910  adv prob = 0.250000   acc = 0.508
Average incurred loss: 0.752  
Average sample loss: 0.752  
Average acc: 0.511  
  Color 0, Class: fmammal  [n = 1586]:	loss = 0.783  exp loss = 0.745  adjusted loss = 0.745  adv prob = 0.250000   acc = 0.494
  Color 0, Class: fbird  [n = 1556]:	loss = 0.747  exp loss = 0.693  adjusted loss = 0.693  adv prob = 0.250000   acc = 0.489
  Color 1, Class: fmammal  [n = 1614]:	loss = 0.753  exp loss = 0.717  adjusted loss = 0.717  adv prob = 0.250000   acc = 0.530
  Color 1, Class: fbird  [n = 1644]:	loss = 0.725  exp loss = 0.694  adjusted loss = 0.694  adv prob = 0.250000   acc = 0.529
Average incurred loss: 0.748  
Average sample loss: 0.748  
Average acc: 0.564  
  Color 0, Class: fmammal  [n = 1622]:	loss = 0.749  exp loss = 0.709  adjusted loss = 0.709  adv prob = 0.250000   acc = 0.557
  Color 0, Class: fbird  [n = 1596]:	loss = 0.832  exp loss = 0.718  adjusted loss = 0.718  adv prob = 0.250000   acc = 0.537
  Color 1, Class: fmammal  [n = 1527]:	loss = 0.708  exp loss = 0.663  adjusted loss = 0.663  adv prob = 0.250000   acc = 0.575
  Color 1, Class: fbird  [n = 1655]:	loss = 0.704  exp loss = 0.682  adjusted loss = 0.682  adv prob = 0.250000   acc = 0.585
Average incurred loss: 0.679  
Average sample loss: 0.679  
Average acc: 0.588  
  Color 0, Class: fmammal  [n = 1585]:	loss = 0.702  exp loss = 0.723  adjusted loss = 0.723  adv prob = 0.250000   acc = 0.557
  Color 0, Class: fbird  [n = 1626]:	loss = 0.686  exp loss = 0.697  adjusted loss = 0.697  adv prob = 0.250000   acc = 0.590
  Color 1, Class: fmammal  [n = 1568]:	loss = 0.666  exp loss = 0.669  adjusted loss = 0.669  adv prob = 0.250000   acc = 0.591
  Color 1, Class: fbird  [n = 1621]:	loss = 0.665  exp loss = 0.664  adjusted loss = 0.664  adv prob = 0.250000   acc = 0.613
Average incurred loss: 0.665  
Average sample loss: 0.665  
Average acc: 0.612  
  Color 0, Class: fmammal  [n = 1650]:	loss = 0.684  exp loss = 0.677  adjusted loss = 0.677  adv prob = 0.250000   acc = 0.585
  Color 0, Class: fbird  [n = 1580]:	loss = 0.667  exp loss = 0.661  adjusted loss = 0.661  adv prob = 0.250000   acc = 0.599
  Color 1, Class: fmammal  [n = 1607]:	loss = 0.645  exp loss = 0.639  adjusted loss = 0.639  adv prob = 0.250000   acc = 0.650
  Color 1, Class: fbird  [n = 1563]:	loss = 0.663  exp loss = 0.681  adjusted loss = 0.681  adv prob = 0.250000   acc = 0.615
Average incurred loss: 0.686  
Average sample loss: 0.685  
Average acc: 0.607  
  Color 0, Class: fmammal  [n = 1369]:	loss = 0.720  exp loss = 0.662  adjusted loss = 0.662  adv prob = 0.250000   acc = 0.603
  Color 0, Class: fbird  [n = 1443]:	loss = 0.702  exp loss = 0.694  adjusted loss = 0.694  adv prob = 0.250000   acc = 0.579
  Color 1, Class: fmammal  [n = 1385]:	loss = 0.661  exp loss = 0.670  adjusted loss = 0.670  adv prob = 0.250000   acc = 0.622
  Color 1, Class: fbird  [n = 1492]:	loss = 0.660  exp loss = 0.624  adjusted loss = 0.624  adv prob = 0.250000   acc = 0.625

Validation:
Average incurred loss: 0.732  
Average sample loss: 0.731  
Average acc: 0.571  
  Color 0, Class: fmammal  [n = 1326]:	loss = 0.784  exp loss = 0.747  adjusted loss = 0.747  adv prob = 0.250000   acc = 0.548
  Color 0, Class: fbird  [n = 1341]:	loss = 0.749  exp loss = 0.667  adjusted loss = 0.667  adv prob = 0.250000   acc = 0.577
  Color 1, Class: fmammal  [n = 1383]:	loss = 0.700  exp loss = 0.634  adjusted loss = 0.634  adv prob = 0.250000   acc = 0.573
  Color 1, Class: fbird  [n = 1334]:	loss = 0.696  exp loss = 0.749  adjusted loss = 0.749  adv prob = 0.250000   acc = 0.586
Current lr: 0.100000
Current validation accuracy: 0.5711367130279541
Best model saved at epoch 0


Epoch [1]:
Training:
Average incurred loss: 0.652  
Average sample loss: 0.652  
Average acc: 0.635  
  Color 0, Class: fmammal  [n = 1574]:	loss = 0.659  exp loss = 0.705  adjusted loss = 0.705  adv prob = 0.250000   acc = 0.631
  Color 0, Class: fbird  [n = 1650]:	loss = 0.669  exp loss = 0.676  adjusted loss = 0.676  adv prob = 0.250000   acc = 0.615
  Color 1, Class: fmammal  [n = 1598]:	loss = 0.638  exp loss = 0.617  adjusted loss = 0.617  adv prob = 0.250000   acc = 0.640
  Color 1, Class: fbird  [n = 1578]:	loss = 0.640  exp loss = 0.624  adjusted loss = 0.624  adv prob = 0.250000   acc = 0.653
Average incurred loss: 0.633  
Average sample loss: 0.633  
Average acc: 0.653  
  Color 0, Class: fmammal  [n = 1606]:	loss = 0.650  exp loss = 0.660  adjusted loss = 0.660  adv prob = 0.250000   acc = 0.636
  Color 0, Class: fbird  [n = 1573]:	loss = 0.656  exp loss = 0.656  adjusted loss = 0.656  adv prob = 0.250000   acc = 0.620
  Color 1, Class: fmammal  [n = 1579]:	loss = 0.614  exp loss = 0.636  adjusted loss = 0.636  adv prob = 0.250000   acc = 0.680
  Color 1, Class: fbird  [n = 1642]:	loss = 0.615  exp loss = 0.606  adjusted loss = 0.606  adv prob = 0.250000   acc = 0.675
Average incurred loss: 0.619  
Average sample loss: 0.619  
Average acc: 0.656  
  Color 0, Class: fmammal  [n = 1598]:	loss = 0.643  exp loss = 0.638  adjusted loss = 0.638  adv prob = 0.250000   acc = 0.622
  Color 0, Class: fbird  [n = 1547]:	loss = 0.633  exp loss = 0.632  adjusted loss = 0.632  adv prob = 0.250000   acc = 0.640
  Color 1, Class: fmammal  [n = 1616]:	loss = 0.599  exp loss = 0.570  adjusted loss = 0.570  adv prob = 0.250000   acc = 0.673
  Color 1, Class: fbird  [n = 1639]:	loss = 0.602  exp loss = 0.616  adjusted loss = 0.616  adv prob = 0.250000   acc = 0.686
Average incurred loss: 0.619  
Average sample loss: 0.619  
Average acc: 0.662  
  Color 0, Class: fmammal  [n = 1596]:	loss = 0.630  exp loss = 0.620  adjusted loss = 0.620  adv prob = 0.250000   acc = 0.637
  Color 0, Class: fbird  [n = 1603]:	loss = 0.642  exp loss = 0.652  adjusted loss = 0.652  adv prob = 0.250000   acc = 0.641
  Color 1, Class: fmammal  [n = 1574]:	loss = 0.597  exp loss = 0.591  adjusted loss = 0.591  adv prob = 0.250000   acc = 0.681
  Color 1, Class: fbird  [n = 1627]:	loss = 0.609  exp loss = 0.586  adjusted loss = 0.586  adv prob = 0.250000   acc = 0.687
Average incurred loss: 0.606  
Average sample loss: 0.606  
Average acc: 0.672  
  Color 0, Class: fmammal  [n = 1613]:	loss = 0.633  exp loss = 0.630  adjusted loss = 0.630  adv prob = 0.250000   acc = 0.636
  Color 0, Class: fbird  [n = 1605]:	loss = 0.633  exp loss = 0.629  adjusted loss = 0.629  adv prob = 0.250000   acc = 0.654
  Color 1, Class: fmammal  [n = 1561]:	loss = 0.566  exp loss = 0.575  adjusted loss = 0.575  adv prob = 0.250000   acc = 0.715
  Color 1, Class: fbird  [n = 1621]:	loss = 0.593  exp loss = 0.597  adjusted loss = 0.597  adv prob = 0.250000   acc = 0.687
Average incurred loss: 0.599  
Average sample loss: 0.599  
Average acc: 0.683  
  Color 0, Class: fmammal  [n = 1423]:	loss = 0.634  exp loss = 0.638  adjusted loss = 0.638  adv prob = 0.250000   acc = 0.650
  Color 0, Class: fbird  [n = 1435]:	loss = 0.620  exp loss = 0.627  adjusted loss = 0.627  adv prob = 0.250000   acc = 0.660
  Color 1, Class: fmammal  [n = 1417]:	loss = 0.560  exp loss = 0.565  adjusted loss = 0.565  adv prob = 0.250000   acc = 0.728
  Color 1, Class: fbird  [n = 1414]:	loss = 0.581  exp loss = 0.573  adjusted loss = 0.573  adv prob = 0.250000   acc = 0.696

Validation:
Average incurred loss: 0.612  
Average sample loss: 0.611  
Average acc: 0.663  
  Color 0, Class: fmammal  [n = 1326]:	loss = 0.653  exp loss = 0.643  adjusted loss = 0.643  adv prob = 0.250000   acc = 0.619
  Color 0, Class: fbird  [n = 1341]:	loss = 0.653  exp loss = 0.634  adjusted loss = 0.634  adv prob = 0.250000   acc = 0.645
  Color 1, Class: fmammal  [n = 1383]:	loss = 0.567  exp loss = 0.526  adjusted loss = 0.526  adv prob = 0.250000   acc = 0.697
  Color 1, Class: fbird  [n = 1334]:	loss = 0.577  exp loss = 0.572  adjusted loss = 0.572  adv prob = 0.250000   acc = 0.691
Current lr: 0.100000
Current validation accuracy: 0.6634472608566284
Best model saved at epoch 1


Epoch [2]:
Training:
Average incurred loss: 0.614  
Average sample loss: 0.614  
Average acc: 0.664  
  Color 0, Class: fmammal  [n = 1603]:	loss = 0.621  exp loss = 0.626  adjusted loss = 0.626  adv prob = 0.250000   acc = 0.657
  Color 0, Class: fbird  [n = 1644]:	loss = 0.647  exp loss = 0.643  adjusted loss = 0.643  adv prob = 0.250000   acc = 0.628
  Color 1, Class: fmammal  [n = 1561]:	loss = 0.595  exp loss = 0.602  adjusted loss = 0.602  adv prob = 0.250000   acc = 0.680
  Color 1, Class: fbird  [n = 1592]:	loss = 0.592  exp loss = 0.601  adjusted loss = 0.601  adv prob = 0.250000   acc = 0.692
Average incurred loss: 0.587  
Average sample loss: 0.587  
Average acc: 0.694  
  Color 0, Class: fmammal  [n = 1550]:	loss = 0.613  exp loss = 0.584  adjusted loss = 0.584  adv prob = 0.250000   acc = 0.676
  Color 0, Class: fbird  [n = 1598]:	loss = 0.623  exp loss = 0.622  adjusted loss = 0.622  adv prob = 0.250000   acc = 0.656
  Color 1, Class: fmammal  [n = 1585]:	loss = 0.557  exp loss = 0.546  adjusted loss = 0.546  adv prob = 0.250000   acc = 0.727
  Color 1, Class: fbird  [n = 1667]:	loss = 0.559  exp loss = 0.550  adjusted loss = 0.550  adv prob = 0.250000   acc = 0.717
Average incurred loss: 0.575  
Average sample loss: 0.575  
Average acc: 0.700  
  Color 0, Class: fmammal  [n = 1576]:	loss = 0.607  exp loss = 0.619  adjusted loss = 0.619  adv prob = 0.250000   acc = 0.666
  Color 0, Class: fbird  [n = 1617]:	loss = 0.593  exp loss = 0.563  adjusted loss = 0.563  adv prob = 0.250000   acc = 0.681
  Color 1, Class: fmammal  [n = 1583]:	loss = 0.545  exp loss = 0.554  adjusted loss = 0.554  adv prob = 0.250000   acc = 0.735
  Color 1, Class: fbird  [n = 1624]:	loss = 0.557  exp loss = 0.568  adjusted loss = 0.568  adv prob = 0.250000   acc = 0.720
Average incurred loss: 0.583  
Average sample loss: 0.583  
Average acc: 0.698  
  Color 0, Class: fmammal  [n = 1648]:	loss = 0.606  exp loss = 0.608  adjusted loss = 0.608  adv prob = 0.250000   acc = 0.679
  Color 0, Class: fbird  [n = 1573]:	loss = 0.616  exp loss = 0.622  adjusted loss = 0.622  adv prob = 0.250000   acc = 0.676
  Color 1, Class: fmammal  [n = 1599]:	loss = 0.563  exp loss = 0.558  adjusted loss = 0.558  adv prob = 0.250000   acc = 0.710
  Color 1, Class: fbird  [n = 1580]:	loss = 0.545  exp loss = 0.536  adjusted loss = 0.536  adv prob = 0.250000   acc = 0.727
Average incurred loss: 0.594  
Average sample loss: 0.594  
Average acc: 0.691  
  Color 0, Class: fmammal  [n = 1628]:	loss = 0.613  exp loss = 0.619  adjusted loss = 0.619  adv prob = 0.250000   acc = 0.675
  Color 0, Class: fbird  [n = 1567]:	loss = 0.623  exp loss = 0.650  adjusted loss = 0.650  adv prob = 0.250000   acc = 0.662
  Color 1, Class: fmammal  [n = 1566]:	loss = 0.564  exp loss = 0.563  adjusted loss = 0.563  adv prob = 0.250000   acc = 0.723
  Color 1, Class: fbird  [n = 1639]:	loss = 0.579  exp loss = 0.585  adjusted loss = 0.585  adv prob = 0.250000   acc = 0.703
Average incurred loss: 0.588  
Average sample loss: 0.589  
Average acc: 0.698  
  Color 0, Class: fmammal  [n = 1405]:	loss = 0.619  exp loss = 0.632  adjusted loss = 0.632  adv prob = 0.250000   acc = 0.670
  Color 0, Class: fbird  [n = 1414]:	loss = 0.629  exp loss = 0.610  adjusted loss = 0.610  adv prob = 0.250000   acc = 0.659
  Color 1, Class: fmammal  [n = 1451]:	loss = 0.538  exp loss = 0.533  adjusted loss = 0.533  adv prob = 0.250000   acc = 0.739
  Color 1, Class: fbird  [n = 1419]:	loss = 0.568  exp loss = 0.601  adjusted loss = 0.601  adv prob = 0.250000   acc = 0.720

Validation:
Average incurred loss: 0.568  
Average sample loss: 0.565  
Average acc: 0.708  
  Color 0, Class: fmammal  [n = 1326]:	loss = 0.599  exp loss = 0.579  adjusted loss = 0.579  adv prob = 0.250000   acc = 0.669
  Color 0, Class: fbird  [n = 1341]:	loss = 0.596  exp loss = 0.584  adjusted loss = 0.584  adv prob = 0.250000   acc = 0.679
  Color 1, Class: fmammal  [n = 1383]:	loss = 0.541  exp loss = 0.512  adjusted loss = 0.512  adv prob = 0.250000   acc = 0.749
  Color 1, Class: fbird  [n = 1334]:	loss = 0.537  exp loss = 0.528  adjusted loss = 0.528  adv prob = 0.250000   acc = 0.732
Current lr: 0.100000
Current validation accuracy: 0.7078380584716797
Best model saved at epoch 2


Epoch [3]:
Training:
Average incurred loss: 0.573  
Average sample loss: 0.573  
Average acc: 0.706  
  Color 0, Class: fmammal  [n = 1573]:	loss = 0.621  exp loss = 0.631  adjusted loss = 0.631  adv prob = 0.250000   acc = 0.664
  Color 0, Class: fbird  [n = 1621]:	loss = 0.611  exp loss = 0.609  adjusted loss = 0.609  adv prob = 0.250000   acc = 0.672
  Color 1, Class: fmammal  [n = 1566]:	loss = 0.526  exp loss = 0.506  adjusted loss = 0.506  adv prob = 0.250000   acc = 0.750
  Color 1, Class: fbird  [n = 1640]:	loss = 0.536  exp loss = 0.541  adjusted loss = 0.541  adv prob = 0.250000   acc = 0.738
Average incurred loss: 0.576  
Average sample loss: 0.576  
Average acc: 0.696  
  Color 0, Class: fmammal  [n = 1646]:	loss = 0.596  exp loss = 0.602  adjusted loss = 0.602  adv prob = 0.250000   acc = 0.663
  Color 0, Class: fbird  [n = 1588]:	loss = 0.618  exp loss = 0.612  adjusted loss = 0.612  adv prob = 0.250000   acc = 0.669
  Color 1, Class: fmammal  [n = 1538]:	loss = 0.557  exp loss = 0.549  adjusted loss = 0.549  adv prob = 0.250000   acc = 0.720
  Color 1, Class: fbird  [n = 1628]:	loss = 0.534  exp loss = 0.526  adjusted loss = 0.526  adv prob = 0.250000   acc = 0.732
Average incurred loss: 0.577  
Average sample loss: 0.577  
Average acc: 0.701  
  Color 0, Class: fmammal  [n = 1605]:	loss = 0.602  exp loss = 0.598  adjusted loss = 0.598  adv prob = 0.250000   acc = 0.674
  Color 0, Class: fbird  [n = 1609]:	loss = 0.617  exp loss = 0.617  adjusted loss = 0.617  adv prob = 0.250000   acc = 0.663
  Color 1, Class: fmammal  [n = 1603]:	loss = 0.539  exp loss = 0.518  adjusted loss = 0.518  adv prob = 0.250000   acc = 0.737
  Color 1, Class: fbird  [n = 1583]:	loss = 0.549  exp loss = 0.574  adjusted loss = 0.574  adv prob = 0.250000   acc = 0.730
Average incurred loss: 0.566  
Average sample loss: 0.566  
Average acc: 0.715  
  Color 0, Class: fmammal  [n = 1526]:	loss = 0.578  exp loss = 0.582  adjusted loss = 0.582  adv prob = 0.250000   acc = 0.696
  Color 0, Class: fbird  [n = 1625]:	loss = 0.606  exp loss = 0.610  adjusted loss = 0.610  adv prob = 0.250000   acc = 0.676
  Color 1, Class: fmammal  [n = 1629]:	loss = 0.527  exp loss = 0.521  adjusted loss = 0.521  adv prob = 0.250000   acc = 0.754
  Color 1, Class: fbird  [n = 1620]:	loss = 0.554  exp loss = 0.535  adjusted loss = 0.535  adv prob = 0.250000   acc = 0.735
Average incurred loss: 0.566  
Average sample loss: 0.566  
Average acc: 0.718  
  Color 0, Class: fmammal  [n = 1612]:	loss = 0.586  exp loss = 0.592  adjusted loss = 0.592  adv prob = 0.250000   acc = 0.699
  Color 0, Class: fbird  [n = 1617]:	loss = 0.585  exp loss = 0.604  adjusted loss = 0.604  adv prob = 0.250000   acc = 0.709
  Color 1, Class: fmammal  [n = 1582]:	loss = 0.533  exp loss = 0.535  adjusted loss = 0.535  adv prob = 0.250000   acc = 0.742
  Color 1, Class: fbird  [n = 1589]:	loss = 0.559  exp loss = 0.558  adjusted loss = 0.558  adv prob = 0.250000   acc = 0.721
Average incurred loss: 0.573  
Average sample loss: 0.573  
Average acc: 0.708  
  Color 0, Class: fmammal  [n = 1448]:	loss = 0.620  exp loss = 0.630  adjusted loss = 0.630  adv prob = 0.250000   acc = 0.671
  Color 0, Class: fbird  [n = 1353]:	loss = 0.602  exp loss = 0.621  adjusted loss = 0.621  adv prob = 0.250000   acc = 0.685
  Color 1, Class: fmammal  [n = 1427]:	loss = 0.537  exp loss = 0.544  adjusted loss = 0.544  adv prob = 0.250000   acc = 0.733
  Color 1, Class: fbird  [n = 1461]:	loss = 0.534  exp loss = 0.505  adjusted loss = 0.505  adv prob = 0.250000   acc = 0.740

Validation:
Average incurred loss: 0.553  
Average sample loss: 0.552  
Average acc: 0.720  
  Color 0, Class: fmammal  [n = 1326]:	loss = 0.591  exp loss = 0.568  adjusted loss = 0.568  adv prob = 0.250000   acc = 0.704
  Color 0, Class: fbird  [n = 1341]:	loss = 0.574  exp loss = 0.533  adjusted loss = 0.533  adv prob = 0.250000   acc = 0.689
  Color 1, Class: fmammal  [n = 1383]:	loss = 0.521  exp loss = 0.485  adjusted loss = 0.485  adv prob = 0.250000   acc = 0.743
  Color 1, Class: fbird  [n = 1334]:	loss = 0.528  exp loss = 0.557  adjusted loss = 0.557  adv prob = 0.250000   acc = 0.744
